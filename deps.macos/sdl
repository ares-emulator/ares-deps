sdl_name='SDL3'
sdl_version='3.4.0'
sdl_url='https://github.com/libsdl-org/SDL.git'
sdl_hash='a962f40bbba175e9716557a25d5d7965f134a3d3'
SDLARGS=()

## Build Steps
sdl_setup() {
  echo "[SDL3] cloning"
  if [ ! -d "SDL" ]; then
    git clone ${sdl_url}
  else
    git -C SDL fetch
  fi
  git -C SDL reset --hard "$sdl_hash"
  export MACOSX_DEPLOYMENT_TARGET=10.15
  echo "[SDL3] cloning -- success"
}

sdl_package_source() {
  echo "[SDL3] packaging source"
  ditto SDL ../ares-deps-source/src/SDL
  echo "[SDL3] packaging source -- success"
}

sdl_clean() {
  echo "[SDL3] cleaning up -- skipped"
}

sdl_patch() {
  echo "[SDL3] patching -- skipped"
}

sdl_build() {
  echo "[SDL3] building"
  SDLARGS=()
  SDLARGS+=("-DCMAKE_OSX_ARCHITECTURES=arm64;x86_64;")
  
  cd SDL
  
  xcodebuild build -project ./Xcode/SDL/SDL.xcodeproj \
                   -scheme "SDL3" \
                   archive \
                   -configuration $config \
                   DEBUG_INFORMATION_FORMAT="dwarf-with-dsym" \
                   -archivePath "$SCRIPT_DIR/build_temp/SDL/build" \
                   ARCHS="x86_64 arm64" \
                   ONLY_ACTIVE_ARCH=FALSE \
                   2>&1 | xcbeautify --renderer github-actions

  cd ..
  echo "[SDL3] building -- success"
}

sdl_install() {
  echo "[SDL3] installing"
  ditto build_temp/SDL/build.xcarchive/Products/Library/Frameworks/SDL3.framework ares-deps/lib/SDL3.framework
  ditto build_temp/SDL/build.xcarchive/dSYMs/SDL3.framework.dSYM ares-deps/lib/SDL3.framework.dSYM
  ditto build_temp/SDL/LICENSE.txt ares-deps/licenses/SDL/LICENSE.txt
  echo "[SDL3] installing -- success"
}



